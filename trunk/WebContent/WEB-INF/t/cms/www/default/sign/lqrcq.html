<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
		<meta name="renderer" content="webkit">
		<meta name="apple-mobile-web-app-capable" content="yes">
	    <meta name="apple-mobile-web-app-status-bar-style" content="black">
	    <meta name="format-detection" content="telephone=no">
	    <meta name="format-detection" content="email=no">
		<title>公益讲座报名</title>
		<link rel="stylesheet" href="${base}/r/sign/iosSelect.css" />
		<link rel="stylesheet" href="${base}/r/sign/rem.css" />
		<script src="${base}/r/sign/jquery-1.11.3.min.js"></script>
		<script src="${base}/r/sign/iosSelect.js"></script>
		<script src="${base}/assets/js/qrcode.js"></script>
		<style type="text/css">
			body{background: -webkit-linear-gradient(#F15D85 15%,#f04d9c,#76478f);background: -moz-linear-gradient(#F15D85 15%,#f04d9c,#76478f);background: linear-gradient(#F15D85 15%,#f04d9c,#76478f);}
			.rcq-head,.rcq-body{width: 100%;}
			.rcq-body{padding: 1rem 0;}
			.body{background: -webkit-linear-gradient(#f04d9c,#76478f);background: -moz-linear-gradient(#f04d9c,#76478f);background: linear-gradient(#f04d9c,#76478f);}
			.outer{z-index: 2;width: 94%;margin: 1rem auto;padding: .6rem 0 4rem;background: #ccbbfb;border:1px dashed #fff;}
			.main{width: 86%;margin: 0 auto;padding: 1rem 0 .1rem;background: #fff;box-shadow:inset 0 .8rem .5rem 0 rgba(0,0,0,.15);border-top-left-radius: 2px;border-top-right-radius: 2px;}
			.rcq-in{position: absolute;z-index: -1;top:0;left: 2.5%;width: 95%;margin: -1.3rem auto 0;}
			.item{margin: .7rem auto;font-size: 1.25rem;}
			.item label{display: inline-block;width: 24%;height: 2.6rem;text-align: right;line-height: 2.6rem;margin-right: 10px;color: #5C3A77;}
			.item input{width: 56%;height: 2.6rem;font-size: 1.1rem;background: #E1E0E6;}
			#tel,#code,#joinNum{width: 31%;}
			#confirmBtn,#codeBtn{width: 5.6667rem;height: 2.6667rem;text-align: center;line-height: 2.5rem;color: #c55813;margin-left: .3rem;vertical-align: middle;font-size: 1rem;background-image: url(${base}/r/sign/img/btn-code.png);background-size: 100% 100%;}
			#lqBtn{display: block;width: 9.3333rem;height: 2.75rem;margin: 0 auto .5rem;background-image: url(${base}/r/sign/img/btn-rcq.png);background-size: 100% 100%;border-radius: 2rem;}
			h6{color: #959595;font-size: 11px;font-weight: normal;padding-top: 3px;text-align:center;}
			.by-left,.by-right{display:none;position: absolute;top: 40%;width: 2rem;height: 4rem;background: #CCBCFB;}
			.by-left{left: -1px; border-radius:0 2rem 2rem 0;}
			.by-right{right: -1px; border-radius: 2rem 0 0 2rem;}
			.footer{position: absolute;z-index: 5;bottom: -2rem;left: 0;width: 100%;height: 1.6667rem;background-image: url(${base}/r/sign/img/rcq-foot.png);background-size: 100% 100%;background-repeat-y: no-repeat;}
			.warn{display: inline-block;color: #FF9535;padding-left: 0;font-size: 12px;}
			#price{margin: .5rem auto;}
			#price label{color: #333;}
			#price h4{display: inline-block;font-size: 1.5rem;color: #FF9535;}
			#price span{color: #FF9535;margin-left: 5px;}
			#hide{display:none;}
			#tip{width: 23.41667rem;font-size: 1rem;color: #555;}
			.tip-img{position: absolute;top:0;left: 0;width: 23.41667rem;height: 4.8333rem;margin-top: -4rem;background-image: url(${base}/r/sign/img/tips-rcq.png);background-size: 100% 100%;}
			.tips{width: 90%;margin: 0 auto;padding: 3rem 1.2rem 2rem;background: #fff;border-radius: 3px;background: #fff;}
			#tip div{line-height: 1.3em;}
			#tip  p{text-indent: 2em;text-align: justify;padding: .5em 0;}
			#tip h4{font-weight: normal;}
			#tip span{font-size: 1rem;color: #FF9858;margin: 0 2px;font-size: bold;}
			@media only screen and (max-width:320px) {
				.main{padding-top: .4rem;}
				.item{margin: .5rem auto;}
				h6 {font-size:10px;}
				.footer{bottom:-1.2rem;height: 1.2rem;}
				.item label,.item input,.item select,.item button,#codeBtn{
					height: 2.2rem;line-height: 2.2rem;
				}
				#price{margin: .3rem auto;}
				#codeBtn,#confirmBtn{height: 2.22rem;}
				.by-left,.by-right{-webkit-transform: scale(.7);transform: scale(.7);}
				.by-left{left: -5px;}
				.by-right{right: -5px;}
			}
			@media only screen and (min-width:384px) and (max-width:416px) {
				.item{margin: 1rem auto;}
				.main{padding-top: .6rem;}
				h6{font-size: 12px;}
			}
		</style>
	</head>
	<body>
		<div class="rcq-head">
			<img src="${base}/r/sign/img/rcq-head.jpg" />
		</div>
		<div class="rcq-body">
			<div class="outer gps">
				<div class="rcq-in">
					<img src="${base}/r/sign/img/rcq-in.png"  />
				</div>
				<div class="main">
					<form action="getAdmissionticket.jspx" method="post" id="lqrcq">
					<input type="hidden" name="activeId" id="activeId" value="${activeId!}">
					<div id="rcq" class="gps">
						<div class="item">
							<label>手机号</label>
							<input id="tel" type="tel" name="telphoto" placeholder="请输入手机号" maxlength="11"/>
							<button id="confirmBtn" type="button">确认</button>
							<br />
							<h6>请输入准确的手机号,凭手机号可享受免费咨询！</h6>
						</div>
						<div id="hide">	
						<div class="item">
							<label>姓名</label>
							<input id="name" type="text" name="name" placeholder="请输入家长姓名"/>
						</div>
						<div id="codeItem" class="item">
							<label>验证码</label>
							<input id="code" type="tel" name="captchaInput" placeholder="请输入验证码" maxlength="6"/>
							<!-- <button id="codeBtn" type="button">获取验证码</button> -->
						</div>
							[#if isShowKind?? && isShowKind==1]
						<<div class="item">
							<label>市区</label>
							<input id="city" type="text" placeholder="选地区" readonly="readonly"/>
							<input type="hidden" name="pro" value="">
							<input type="hidden" name="city" value="">
							<input type="hidden" name="county" value="">
						</div>
						<div class="item">
							<label>学校</label>
							<input id="school" type="text"  placeholder="选学校" readonly="readonly" disabled/>
							<input type="hidden" name="schoolName" value="">
						</div>
						<div class="item">
							<label>年级</label>
							<input id="grade" type="text" placeholder="选年级" readonly="readonly"/>
							<input type="hidden" name="grade" value="">
						</div>
						<div class="item">
							<label>文理科</label>
							<input id="wl" type="text" placeholder="选文理科" readonly="readonly"/>
							<input type="hidden" name="majorType" value="">
						</div>
							[/#if]
						<!--<div class="item">-->
							<!--<label>年级排名</label>-->
							<!--<input id="rank" type="tel" name="class_rank" placeholder="输入年级排名" maxlength="5"/>-->
							<!--<br />-->
							<!--<h6>最近考试的总分在本年级排名！</h6>-->
						<!--</div>-->
						<div style="margin-left: 24%;font-size: 0.6rem;color: blue;"><input style="display: inline-block;height: 20px;width: 20px" type="checkbox" value="true" id="ifzxd">
							<input type="hidden" name="ifzxd" value="">
							<a style="font-size: 1.5rem;">我要申请免费咨询</a> <br/><br/>
							<p style="font-size: 1.0rem;color: red;"> 1、定位省排名，确定目标大学</p>
							<p style="font-size: 1.0rem;color: red;">2、自招&综评材料准备</p>
							<p style="font-size: 1.0rem;color: red;">3、了解高考政策与录取规则</p>
							<p style="font-size: 1.0rem;color: red;">4、咨询自招&综评、志愿填报个性化服务</p>
						</div>
						</div>
						<div class="item" id="price">
							<label>公益讲座</label>
							<h4>¥${free!}</h4><span>(免费活动)</span>
						</div>
						<button id="lqBtn" type="button"></button>
						<div class="by-left"></div>
						<div class="by-right"></div>
						<div class="footer"></div>
					</div>
					</form>
				</div>
				
			</div>
			
		</div>
		<div id="toast" class="abs-center">请输入正确的姓名！</div>
		<div class="fixed-filter">
			<div class="abs-center">
				<div id="tip" class="gps">
					<div class="tip-img"></div>
					<div class="tips">
						<h4>尊敬的<span>1762345333</span>家长:</h4>
						<p>请您准时参加《沃得教育讲座讲座》,到场可免费领取xx资料一份。</p>
						<div>您是第<span>1</span>位领取入场券的家长！</div>
						<div>时间:2018-10-10 下午12:20</div>
						<div>地点:2018-10-10 下午12:20</div>
						<h4>请截图并保存当前页面！</h4>
					</div>
				</div>
			</div>
		</div>
	</body>
	<script src="${base}/r/sign/city.min.js"></script>
	<script type="text/javascript">
		var activeid=$('#activeId').val();
		var gradeList = [
		    {'id':'1','value':'2019届'},
		    {'id':'2','value':'2020届'},
		    {'id':'3','value':'2021届'}
		  ];
	 	var wlList = [
		     {'id':'1','value':'文科'},
		     {'id':'2','value':'理科'},
		     {'id':'3','value':'综合改革'}
		   ];
	 	var joinList = [
		     {'id':'1','value':'1人'},
		     {'id':'2','value':'2人'},
		     {'id':'3','value':'3人'}
		   ];
	 	//toast
		function toast(type){
			if(type=='getError'){
				$('#toast').html('领取失败，请稍后重试！');
			};
			$('#toast').fadeIn();
			setTimeout(function(){
				$('#toast').fadeOut();
			},2000);
		};	
		var proName = '',cityName = '',qxName = '',grade='',wl='',schoolName='';
		//手机号验证
		var type='';
		$('#confirmBtn').click(function(){
			//检测手机
			var	regTel = /^1[34578]\d{9}$/;
			var tel = $('#tel').val();
			if(!regTel.test(tel)){
				$('#toast').html('请检查手机号！');
				toast();
				return false;
			};
			$.ajax({
				url : 'getCapt.jspx',
				data:{
					telphoto:$("#tel").val(),
					activeid:activeid,
					type:'bm'
				},
				type : "GET",
				error: function(msg){
					console.log(msg);
					$('#toast').html('请稍后重试！');
					toast();
					return false;
				},
				success: function(data) {
				　 	var res = eval('(' + data + ')');
				　 	console.log(res);
				　 	//未参与
				 	if(res.type==0){
				 		type=0;
				 		$('#hide').slideDown('fast');
						$('.rcq-body').addClass('body');
						$('.by-left').show();
						$('.by-right').show();
                        $('#city').attr('data-province-code', res.userinfo.pro_code);
                        $('#city').attr('data-city-code', res.userinfo.city_code);

						var count = 60;
					 	var resend = setInterval(function(){
			                count--;
			                if (count > 0){
			                	$('#confirmBtn').text(count+'s').attr('disabled','disabled');
			                }else {
			                    clearInterval(resend);
			                    $('#confirmBtn').text('重新获取').removeAttr('disabled');
			                }
			            }, 1000);
				 	};
				 	//禁止重复领取
				 	if(res.type==1){
				 		type=1;
				 		var adInfo = res.activeinfo;
				 		console.log('ad',adInfo)
				 		var html ='<h4>尊敬的<span>'+adInfo.username+'</span>家长:</h4>'+
				 				'<p>请您准时参加《'+adInfo.theme+'》讲座';
				 				if(adInfo.lqzl_content){
				 					html+=','+adInfo.lqzl_content;
				 				};
								html+='</p><div>您是第<span>'+adInfo.bm_rank+'</span>位领取入场券的家长！</div>'+
								'<div>时间:'+adInfo.active_time+'</div>'+
								'<div>地点:'+adInfo.address+'</div><h4>请截图并保存当前页面！</h4>';
						$('.tips').html(html);	
				 		$('.fixed-filter').fadeIn();
				 	};
				 	//已注册未付款
					if(res.type==2){
						type=2;
						var oldInfo = res.userinfo;
						$('#codeItem').hide();
						$('#hide').slideDown('fast');
						$('.rcq-body').addClass('body');
						$('.by-left').show();
						$('.by-right').show();
						if(oldInfo){
							$('#name').val(oldInfo.username);
							if(oldInfo.province!=null){
								$('#rank').val(oldInfo.class_rank);
						 		$('#city').attr('data-province-code', oldInfo.pro_code);
			                    $('#city').attr('data-city-code', oldInfo.city_code);
			                    $('#city').attr('data-district-code', oldInfo.quxian_code);
						 		$('#city').val(oldInfo.province + ' ' + oldInfo.city + ' ' + oldInfo.quxian);
						 		$('#school').attr('data-school-code', oldInfo.school_code);
						 		$('#school').val(oldInfo.school_name);
						 		$('#grade').attr('grade', oldInfo.classes);
						 		if(oldInfo.classes==1){
						 			$('#grade').val("高一");
						 		};
						 		if(oldInfo.classes==2){
						 			$('#grade').val("高二");
						 		};
						 		if(oldInfo.classes==3){
						 			$('#grade').val("高三");
						 		};
						 		$('#wl').attr('wl', oldInfo.majortype);
						 		$('#wl').val(oldInfo.major_type);
						 		var allName =  $('#city').val().split(' ');
						 		proName = allName[0],cityName = allName[1],qxName = allName[2];
						 		grade = oldInfo.classes;
						 		wl = oldInfo.major_type;
							};
							
					 	};
				 	};
				}
			});
		});
		//选择市区
		var schoolData=[];
		$('#city').on('click', function () {
    		var oneLevelId = $('#city').attr('data-province-code');
    		var twoLevelId = $('#city').attr('data-city-code');
    		var threeLevelId = $('#city').attr('data-district-code');
    		var iosSelect = new IosSelect(3, [prolist, citylist, quxianlist],
    			{
	                title: '选择市区',
	                itemHeight: 40,
	                itemShowCount: 5,
	                relation: [1, 1],
	                oneLevelId: oneLevelId,
	                twoLevelId: twoLevelId,
	                threeLevelId: threeLevelId,
	                callback: function (selectOneObj, selectTwoObj, selectThreeObj) {
	                    $('#city').attr('data-province-code', selectOneObj.id);
	                    $('#city').attr('data-city-code', selectTwoObj.id);
	                    $('#city').attr('data-district-code', selectThreeObj.id);
	                    $('#city').val(selectOneObj.value + ' ' + selectTwoObj.value + ' ' + selectThreeObj.value);
	                    if(selectThreeObj.value == '全部'){
	                    	$('#toast').html('请不要选择全部地区！');
	    					toast();
	    					return false;
	                    };
	                    proName =  selectOneObj.value;
	                	cityName =  selectTwoObj.value;
	                	qxName =  selectThreeObj.value;
	                	$.ajax({
	        				url : '${base}/sign/getschool.jspx',
	        				data:'quxiancode='+selectThreeObj.id,
	        				type : "get",
	        				error: function(msg){
	        					console.log(msg);
	        					$('#toast').html('获取学校信息失败，请稍后重试！');
	        					toast();
	        					return false;
	        				},
	        				beforeSend:function(){
	        					$('#school').attr('disabled','disabled');
	        				},
	        				success: function(data) {
	        				  var res = eval('(' + data + ')');
	        				  var schoolList =  res.schoollist;
	        				  if(schoolList.length==0){
		                        	schoolData = [{'id': '0000', 'value': '暂无数据，请重新选择地区',"parentId":"0000"}];
		                    	}else{
		                         	schoolData=schoolList;
		                   	 	};
		                   	 	$('#school').removeAttr('disabled');
	        				}
	        			});
	                }
	       		}
    		);
	    });
	    //选择学校
	    $('#school').on('click',function(){
	    	//检测市区
			var city = $('#city').val();
			if(city==null||city==0||city==undefined){
				$('#toast').html('请先选择市区！');
				toast();
				return false;
			};
	        var oneLevelId = $('#school').attr('data-school-code');
	        var iosSelect = new IosSelect(1, [schoolData],
	     		{
	                title: '选择学校',
	                itemHeight: 40,
	                itemShowCount: 5,
	                oneLevelId: oneLevelId,
	                callback: function (selectOneObj) {
	                	 $('#school').attr('data-school-code',selectOneObj.id);
	                     $('#school').val(selectOneObj.value);
                        schoolName=selectOneObj.value;
	            	}
	        });
	    });
	    //选择年级
	    $('#grade').on('click',function(){
	    	var oneLevelId = $('#grade').attr('grade');
	        var iosSelect = new IosSelect(1, [gradeList],
	     		{
	                title: '选择年级',
	                itemHeight: 40,
	                itemShowCount: 3,
	                oneLevelId: oneLevelId, 
	                callback: function (selectOneObj) {
	                	$('#grade').attr('grade',selectOneObj.id);
	                     $('#grade').val(selectOneObj.value);
                        grade=selectOneObj.value;
	            	}
	        });
	    });
	    //选择文理科
	    $('#wl').on('click',function(){
	    	var oneLevelId = $('#wl').attr('wl');
	        var iosSelect = new IosSelect(1, [wlList],
	     		{
	                title: '选择文理科',
	                itemHeight: 40,
	                itemShowCount: 3,
	                oneLevelId: oneLevelId,
	                callback: function (selectOneObj) {
	                	 $('#wl').attr('wl',selectOneObj.id);
	                     $('#wl').val(selectOneObj.value);
                        wl=selectOneObj.value;
	            	}
	        });
	    });
	   
		//领取入场券
		$('#lqBtn').click(function(){
			//检测姓名
			var regName = /^[\u4e00-\u9fa5]{2,4}$/;
			var name = $('#name').val();
			if(!regName.test(name)){
				$('#toast').html('请检查姓名！');
				toast();
				return false;
			};
			//检测手机
			var	regTel = /^1[34578]\d{9}$/;
			var tel = $('#tel').val();
			if(!regTel.test(tel)){
				$('#toast').html('请检查手机号！');
				toast();
				return false;
			};
			//检测验证码
			if(type==0){
				var codeInput = $('#code').val();
				if(codeInput.length!=6){
					$('#toast').html('请检查验证码！');
					toast();
					return false;
				};
			};
			//检测市区
			// var city = $('#city').val();
			// if(city==null||city==0||city==undefined){
			// 	$('#toast').html('请选择市区！');
			// 	toast();
			// 	return false;
			// };
			// //检测学校
			// var school = $('#school').val();
			// if(school==null||school==0||school==undefined){
			// 	$('#toast').html('请选择学校！');
			// 	toast();
			// 	return false;
			// };
			// //检测年级
			// var grade = $('#grade').val();
			// if(grade==null||grade==0||grade==undefined){
			// 	$('#toast').html('请选择年级！');
			// 	toast();
			// 	return false;
			// };
			// //检测文理科
			// var wl = $('#wl').val();
			// if(wl==null||wl==0||wl==undefined){
			// 	$('#toast').html('请选择文理科！');
			// 	toast();
			// 	return false;
			// };
			//检测年级排名
			// var rank = $('#rank').val();
			// if(rank==null||rank==0||rank==undefined){
			// 	$('#toast').html('请输入正确的年级排名！');
			// 	toast();
			// 	return false;
			// };
            var ifzxd = $("input[type='checkbox']").prop('checked');
			$(this).attr('disabled','disabled');
			$("input[name='pro']").val(proName);
			$("input[name='city']").val(cityName);
			$("input[name='county']").val(qxName);
			$("input[name='schoolName']").val(schoolName);
			$("input[name='majorType']").val(wl);
			$("input[name='grade']").val(grade);
			$("input[name='ifzxd']").val(ifzxd);

			// console.log(proName,cityName,qxName,school);
			$('#lqrcq').submit();
		});
	</script>
</html>
